# Cape Cod Restaurant Consulting - Cloudflare Configuration
name = "restaurant-consulting-site"
# NOTE: For Pages projects, set CLOUDFLARE_ACCOUNT_ID env var instead of account_id in config
# CLOUDFLARE_ACCOUNT_ID=373a6cef1f9ccf5d26bfd9687a91c0a6
compatibility_date = "2024-01-01"
pages_build_output_dir = "dist"

# ============================================
# RESOURCE BINDINGS
# These define what Cloudflare services are available to your Functions
# ============================================

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "rg-consulting-forms"
database_id = "eb39c9a2-24ed-426e-9260-a1fb55d899cb"

# KV Namespace for rate limiting and session storage
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "57fda5bf0515423db01df17ed5b335e6"

# R2 Bucket for file storage (PDFs, menu uploads, images)
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "ccrc-uploads"

# Cloudflare AI for OCR and text processing
[ai]
binding = "AI"

# ============================================
# ENVIRONMENT VARIABLES
# Set these in Cloudflare Dashboard > Pages > Settings > Environment Variables
# OR in .dev.vars for local development
# ============================================
#
# REQUIRED:
#   ADMIN_PASSWORD_HASH    - SHA-256 hash of admin password
#                            Generate: echo -n "YOUR_PASSWORD" | openssl dgst -sha256
#
# OPTIONAL (have defaults):
#   JWT_SECRET             - Secret for signing JWTs (defaults to ADMIN_PASSWORD_HASH)
#   CLIENT_JWT_SECRET      - Secret for client portal tokens (defaults to JWT_SECRET)
#
# SQUARE API (Legacy - use Stripe for new integrations):
#   SQUARE_ACCESS_TOKEN    - From https://developer.squareup.com
#   SQUARE_ENVIRONMENT     - 'sandbox' or 'production'
#   SQUARE_LOCATION_ID_LANE_A - L6GGMPCHFM6WR (Local Cape Cod)
#   SQUARE_LOCATION_ID_LANE_B - LB8GE5HYZJYB7 (National Remote)
#   SQUARE_WEBHOOK_SIGNATURE_KEY - Webhook verification key
#
# STRIPE API (Primary billing system):
#   STRIPE_SECRET_KEY      - From https://dashboard.stripe.com/apikeys
#                            Use sk_test_xxx for testing, sk_live_xxx for production
#   STRIPE_PUBLISHABLE_KEY - pk_test_xxx or pk_live_xxx (for frontend)
#   STRIPE_WEBHOOK_SECRET  - whsec_xxx from webhook endpoint settings
#                            Configure webhook at: /api/stripe/webhook
#
# PANDADOC (for contracts/proposals):
#   PANDADOC_API_KEY       - From https://app.pandadoc.com/a/#/settings/api
#
# HUBSPOT:
#   HUBSPOT_ACCESS_TOKEN   - From https://app.hubspot.com/private-apps/243379742
#
# RESEND (Email):
#   RESEND_API_KEY         - From https://resend.com/api-keys
#                            Used for contact forms, quote emails, magic link auth
#   RESEND_WEBHOOK_SECRET  - For webhook signature verification
#
# CONTEXT ENGINE (Data Context Engine Integration):
#   CONTEXT_SYNC_KEY       - API key for headless sync scripts pushing data to /api/context/sync
#                            Falls back to ADMIN_PASSWORD_HASH if not set
#   CONTEXT_ENGINE_URL     - (Optional) Live Context Engine URL (e.g., Cloudflare Tunnel)
#                            Only needed if pulling live data from DATA_CONTEXT API
#   CONTEXT_ENGINE_KEY     - (Optional) Bearer token for live Context Engine access
#                            Only needed if CONTEXT_ENGINE_URL is configured


# ============================================
# WORKERS-ONLY FEATURES (NOT SUPPORTED BY PAGES)
# These features require a separate Cloudflare Worker
# Kept here for reference - will be moved to a dedicated worker
# ============================================
#
# CRON TRIGGERS (requires Worker, not Pages)
# [triggers]
# crons = ["*/5 * * * *"]  # Every 5 minutes - email sequence dispatcher
#
# QUEUE BINDINGS (requires Worker, not Pages)
# [[queues.producers]]
# binding = "EMAIL_QUEUE"
# queue = "email-dispatch-queue"
#
# [[queues.consumers]]
# queue = "email-dispatch-queue"
# max_batch_size = 2       # Matches Resend's 2 emails/second limit
# max_batch_timeout = 5    # Wait up to 5 seconds to batch
# max_retries = 3
# dead_letter_queue = "email-dispatch-dlq"
