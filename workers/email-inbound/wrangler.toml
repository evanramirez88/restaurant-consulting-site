# Email Inbound Worker - Cloudflare Worker for Inbound Email Processing
# Receives inbound emails via Resend webhook and processes them with AI classification
# Deployed separately from the main Pages project

name = "rg-email-inbound"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Account configuration
account_id = "373a6cef1f9ccf5d26bfd9687a91c0a6"

# ============================================
# D1 DATABASE BINDING
# Same database as the main Pages project
# ============================================
[[d1_databases]]
binding = "DB"
database_name = "rg-consulting-forms"
database_id = "eb39c9a2-24ed-426e-9260-a1fb55d899cb"

# ============================================
# KV NAMESPACE BINDING
# For caching and rate limiting
# ============================================
[[kv_namespaces]]
binding = "KV"
id = "57fda5bf0515423db01df17ed5b335e6"

# ============================================
# R2 BUCKET BINDING
# For storing email attachments (menus, documents)
# ============================================
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "ccrc-uploads"

# ============================================
# CLOUDFLARE AI BINDING
# For email classification and content analysis
# ============================================
[ai]
binding = "AI"

# ============================================
# ENVIRONMENT VARIABLES
# Set via wrangler secret put
# ============================================
# Required secrets:
#   RESEND_INBOUND_WEBHOOK_SECRET - Webhook signature verification
#   WORKER_API_KEY                - API key for admin endpoints

[vars]
ENVIRONMENT = "production"
# Business email addresses to accept inbound emails for
ALLOWED_TO_ADDRESSES = "ramirezconsulting.rg@gmail.com,support@ccrestaurantconsulting.com,hello@ccrestaurantconsulting.com"
